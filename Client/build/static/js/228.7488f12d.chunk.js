"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[228],{3228:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var s=n(5043),r=n(3003),a=n(8235),o=n(1637),c=n(5749),i=n(229),l=n(579);function d(e){let{state:t,selectedUser:n,roomId:d,user:u}=e;const m=(0,c.io)("http://localhost:5000"),g=(0,r.wA)(),h=(0,r.d4)((e=>e.newMessage)),[v,f]=(0,s.useState)(null),p=(0,s.useRef)(null),[x,j]=(0,s.useState)(null),y=e=>{const t=new Date(e),n=t.getDate(),s=t.getMonth()+1,r=t.getFullYear();return"".concat(n<10?"0"+n:n,"-").concat(s<10?"0"+s:s,"-").concat(r)};(0,s.useEffect)((()=>{(async e=>{try{const t=await fetch("".concat("http://localhost:5000","/conversation"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversationId:e})});if(!t.ok)return void console.log("Error:",t.status,t.statusText);{const e=await t.json();e&&e.conversation.length>0?f(e.conversation):(f([]),document.getElementById("conversation").innerHTML='<div id="deaultConvo">No conversation with '.concat(n.username,"</div>"))}}catch(t){console.error("Error fetching session:",t)}})(d)}),[d]),(0,s.useEffect)((()=>{n&&f(null)}),[n]),(0,s.useEffect)((()=>{h&&(f((e=>[...e,h])),g((0,a.hh)()))}),[h,g]),(0,s.useEffect)((()=>(m.on("get_message",(e=>{if(u.username===e.to.username){let t={date:new Date,from:e.from.email,message:e.message};f((e=>[...e,t])),g((0,a.hh)())}})),()=>{m.disconnect(),m.off("get_message")})),[m]),(0,s.useEffect)((()=>{p.current&&(p.current.scrollTop=p.current.scrollHeight-p.current.clientHeight)}),[h,v]);return(0,l.jsx)("div",{ref:p,id:"conversation",name:"conversation",className:"conversation",children:v?v.map(((e,t)=>{var s;const{message:r,url:a}=(e=>{const[t,n]=null===e||void 0===e?void 0:e.split("#$IMG$#");return{message:t,url:n}})(null===e||void 0===e?void 0:e.message),o=(e=>{const t=null===e||void 0===e?void 0:e.match(/(https?:\/\/[^\s]+)/);if(t){const n=t[0];return e.replace(n,'<a href="'.concat(n,'" target="_blank" rel="noopener noreferrer">').concat(n,"</a>"))}return e})(r),c=(e=>{const t=e.replace(/\n/g,"<br />");return"".concat(t)})(o),d=e.from,m=null===u||void 0===u?void 0:u.primaryEmailAddress.emailAddress;let g=null===(s=(e=>{const t=new Date(e),n=t.getHours(),s=t.getMinutes(),r=n>=12?"PM":"AM",a=n%12||12;return{date:y(e),time:"".concat(a,":").concat(s<10?"0"+s:s," ").concat(r)}})(e.date))||void 0===s?void 0:s.time;return(0,l.jsxs)("div",{className:d===m?"messageFromCurrentUser":"messageFromSecondUser",children:[(0,l.jsx)("div",{className:"avatarContainer",children:(0,l.jsx)("img",{src:d===m?u.imageUrl:n.image_url,alt:d===m?u.username+" image":n.username+" image"})}),(0,l.jsxs)("div",{className:"textMessageCont",children:[(0,l.jsx)("h4",{children:(0,i.Ay)(c)}),a&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("img",{loading:"lazy",src:a,alt:(0,i.Ay)(r)}),(0,l.jsx)("h4",{children:(0,i.Ay)(c)})]}),(0,l.jsx)("span",{children:g})]})]},t)})):(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",gap:10},id:"conversation",name:"conversation",className:"conversation",children:[(0,l.jsx)(o.A,{}),(0,l.jsx)("p",{children:"Loading..."})]})})}}}]);
//# sourceMappingURL=228.7488f12d.chunk.js.map