"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[228],{3228:(e,n,t)=>{t.r(n),t.d(n,{default:()=>l});var s=t(5043),r=t(3003),a=t(8235),o=t(1637),c=t(5749),i=t(579);function l(e){let{state:n,selectedUser:t,roomId:l,user:d}=e;const u=(0,r.wA)(),m=(0,r.d4)((e=>e.newMessage)),[g,h]=(0,s.useState)(null),v=(0,s.useRef)(null),f=e=>{const n=new Date(e),t=n.getHours(),s=n.getMinutes(),r=t>=12?"PM":"AM",a=t%12||12,o=p(e);return"| ".concat(o," | ").concat(a,":").concat(s<10?"0"+s:s," ").concat(r)},p=e=>{const n=new Date(e),t=n.getDate(),s=n.getMonth()+1,r=n.getFullYear();return"".concat(t<10?"0"+t:t,"-").concat(s<10?"0"+s:s,"-").concat(r)};return(0,s.useEffect)((()=>{(async e=>{try{const n=await fetch("".concat("https://realtime-chat-app-u5mw.onrender.com","/conversation"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversationId:e})});if(!n.ok)return void console.log("Error:",n.status,n.statusText);{const e=await n.json();e&&e.conversation.length>0?h(e.conversation):(h([]),document.getElementById("conversation").innerHTML='<div id="deaultConvo">No conversation with '.concat(t.username,"</div>"))}}catch(n){console.error("Error fetching session:",n)}})(l)}),[l]),(0,s.useEffect)((()=>{t&&h(null)}),[t]),(0,s.useEffect)((()=>{m&&(console.log(m),h((e=>[...e,m])),u((0,a.hh)()))}),[m,u]),(0,s.useEffect)((()=>{const e=(0,c.io)("https://realtime-chat-app-u5mw.onrender.com");return e.on("get_message",(e=>{if(d.username===e.to.username){let n={date:new Date,from:e.from.email,message:e.message};h((e=>[...e,n])),u((0,a.hh)())}})),()=>{e.off("get_message")}}),[]),(0,s.useEffect)((()=>{v.current&&(v.current.scrollTop=v.current.scrollHeight-v.current.clientHeight)}),[m,g]),(0,i.jsx)("div",{ref:v,id:"conversation",name:"conversation",className:"conversation",children:g?null===g||void 0===g?void 0:g.map(((e,n)=>{const{message:s,url:r}=(e=>{const[n,t]=null===e||void 0===e?void 0:e.split("#$IMG$#");return{message:n,url:t}})(null===e||void 0===e?void 0:e.message),a=(e=>{const n=null===e||void 0===e?void 0:e.match(/(https?:\/\/[^\s]+)/);if(n){const t=n[0],s=e.replace(t,'<a href="'.concat(t,'" target="_blank" rel="noopener noreferrer">').concat(t,"</a>"));return(0,i.jsx)("span",{dangerouslySetInnerHTML:{__html:s}})}return(0,i.jsx)("span",{children:e})})(s),o=e.from,c=null===d||void 0===d?void 0:d.primaryEmailAddress.emailAddress;return(0,i.jsxs)("div",{className:o===c?"messageFromCurrentUser":"messageFromSecondUser",children:[(0,i.jsx)("div",{className:"avatarContainer",children:(0,i.jsx)("img",{src:o===c?d.imageUrl:t.image_url,alt:o===c?d.username+" image":t.username+" image"})}),(0,i.jsxs)("div",{className:"textMessageCont",children:[(0,i.jsx)("h4",{children:a}),r&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("img",{loading:"lazy",src:r,alt:s}),(0,i.jsx)("h4",{children:s})]}),(0,i.jsx)("span",{children:f(e.date)})]})]},n)})):(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",gap:10},id:"conversation",name:"conversation",className:"conversation",children:[(0,i.jsx)(o.A,{}),(0,i.jsx)("p",{children:"Loading..."})]})})}}}]);
//# sourceMappingURL=228.119b6977.chunk.js.map